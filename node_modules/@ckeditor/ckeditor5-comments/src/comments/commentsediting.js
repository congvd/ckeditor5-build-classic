/*
 *             Copyright (c) 2016 - 2021, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5dc9=['low','markerToData','push','change:isThreadsLoadingPaused','_handleMarkerAddAndRemove','_detachCommentThread','has','editor','length','registerPostFixer','schema','commands','delete','editing','_attachedThreads','change','conversion','then','change:isReadOnly','upcast','CommentsEditing','model','end','map','removeCommentThread','$graveyard','CommentsRepository','isEqual','listenTo','config','isCollapsed','activeMarker','document','text','createPositionBefore','getWalker','stop','init','isThreadsLoadingPaused','markers','createRange','destroyed','getCommentThread','high','updateMarker','differ','_changedMarkers','change:activeMarker','_threads','pluginName','update:comment','getMarkersGroup','get','getAllMarkersForId','hasMarkerForId','getCommentThreads','add','split','rootName','_attachThreadToMarker','comment:','openNewCommentThread','createElement','start','dataDowncast','set','data','removeMarker','ck-comment-marker','destroy','top','dataToMarker','ck-comment-marker--active','elementToElement','for','markerToHighlight','$marker','attachTo','name','_initializeMarkerConverters','newRange','plugins','state','once','addCommentThread','collaboration.channelId','hasCommentThread','editingDowncast','managedUsingOperations','comment'];(function(_0x534a3,_0x5dc9cd){const _0x4f3d92=function(_0x4409de){while(--_0x4409de){_0x534a3['push'](_0x534a3['shift']());}};_0x4f3d92(++_0x5dc9cd);}(_0x5dc9,0x65));const _0x4f3d=function(_0x534a3,_0x5dc9cd){_0x534a3=_0x534a3-0x0;let _0x4f3d92=_0x5dc9[_0x534a3];return _0x4f3d92;};import{Plugin as _0x13412e}from'ckeditor5/src/core';import{Rect as _0x19002f}from'ckeditor5/src/utils';import _0x37ed0f from'./commentsrepository';import _0x3e7762 from'./addcommentthreadcommand';import _0x41970a from'../utils/getmarkerdomelement';import _0x32fa7b from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class r extends _0x13412e{static get['requires'](){return[_0x37ed0f,_0x32fa7b];}static get[_0x4f3d('0x26')](){return _0x4f3d('0x9');}constructor(_0x20bdaa){super(_0x20bdaa),this[_0x4f3d('0x36')]('isThreadsLoadingPaused',!0x0),_0x20bdaa[_0x4f3d('0x37')][_0x4f3d('0x48')]('ready',()=>this[_0x4f3d('0x1b')]=!0x1),this['set'](_0x4f3d('0x14'),null),this['on'](_0x4f3d('0x24'),(_0x303f6f,_0x23dc79,_0x34bd1b,_0x30ef55)=>{_0x20bdaa[_0x4f3d('0xa')]['change'](_0x3a9c5d=>{if(_0x34bd1b){const {id:_0x4ce1c5}=k(_0x34bd1b),_0x4cb235=this[_0x4f3d('0x2a')](_0x4ce1c5);for(const _0x5b36eb of _0x4cb235)_0x3a9c5d[_0x4f3d('0x21')](_0x5b36eb);}if(_0x30ef55){const {id:_0x5c0a50}=k(_0x30ef55),_0x160d3f=this[_0x4f3d('0x2a')](_0x5c0a50);for(const _0x399a55 of _0x160d3f)_0x3a9c5d[_0x4f3d('0x21')](_0x399a55);}});}),this[_0x4f3d('0x3')]=new Set();}[_0x4f3d('0x1a')](){const _0x5f04c2=this[_0x4f3d('0x56')],_0x3f48a0=_0x5f04c2[_0x4f3d('0x46')][_0x4f3d('0x29')](_0x4f3d('0xf')),_0x190371=_0x5f04c2['config'][_0x4f3d('0x29')](_0x4f3d('0x4a'));_0x5f04c2[_0x4f3d('0x0')][_0x4f3d('0x2d')](_0x4f3d('0x49'),new _0x3e7762(_0x5f04c2)),this['listenTo'](_0x5f04c2,_0x4f3d('0x7'),(_0x463ea6,_0x545c24,_0x44a238)=>{_0x3f48a0['switchReadOnly'](_0x44a238,_0x5f04c2[_0x4f3d('0x12')][_0x4f3d('0x29')]('collaboration.channelId'));}),this[_0x4f3d('0x11')](_0x3f48a0,g(_0x4f3d('0xd'),_0x190371),(_0xbafcc7,{threadId:_0x1667f3})=>{_0x5f04c2[_0x4f3d('0xa')][_0x4f3d('0x4')](_0x1c6e44=>{for(const _0x40ce86 of this['getAllMarkersForId'](_0x1667f3))_0x1c6e44[_0x4f3d('0x38')](_0x40ce86);});const _0x27034f=_0x3f48a0[_0x4f3d('0x1f')](_0x1667f3);_0x3f48a0[_0x4f3d('0x4b')](_0x1667f3)&&!_0x27034f['length']||_0xbafcc7[_0x4f3d('0x19')]();},{'priority':_0x4f3d('0x20')}),this[_0x4f3d('0x11')](_0x3f48a0,g('addComment',_0x190371),(_0x177c81,{threadId:_0x4a7006,isFromAdapter:_0x9e9e2c})=>{const _0x259deb=this[_0x4f3d('0x2a')](_0x4a7006);if(_0x9e9e2c||0x0==_0x259deb['length']||!_0x3f48a0['hasCommentThread'](_0x4a7006))return;0x1===_0x3f48a0[_0x4f3d('0x1f')](_0x4a7006)[_0x4f3d('0x57')]&&_0x5f04c2['model'][_0x4f3d('0x4')](_0x50cce9=>{for(const _0x2a395e of _0x259deb)_0x50cce9[_0x4f3d('0x21')](_0x2a395e,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x4f3d('0x4f')}),this[_0x4f3d('0x44')](),this[_0x4f3d('0x53')]();}[_0x4f3d('0x3a')](){const _0x378956=this[_0x4f3d('0x56')][_0x4f3d('0x46')][_0x4f3d('0x29')](_0x4f3d('0xf')),_0x404d33=this[_0x4f3d('0x56')][_0x4f3d('0x12')][_0x4f3d('0x29')](_0x4f3d('0x4a'));for(const _0x15cc1e of _0x378956[_0x4f3d('0x2c')]({'channelId':_0x404d33}))_0x378956[_0x4f3d('0x54')](_0x15cc1e['id']),_0x378956[_0x4f3d('0x25')][_0x4f3d('0x1')](_0x15cc1e['id']);super['destroy']();}[_0x4f3d('0x2b')](_0x1fc117){return this[_0x4f3d('0x2a')](_0x1fc117)[_0x4f3d('0x57')]>0x0;}[_0x4f3d('0x2a')](_0x4ff67a){const _0x1313d0=this[_0x4f3d('0x56')][_0x4f3d('0xa')][_0x4f3d('0x1c')][_0x4f3d('0x29')](_0x4f3d('0x31')+_0x4ff67a);return _0x1313d0?[_0x1313d0]:Array['from'](this[_0x4f3d('0x56')][_0x4f3d('0xa')][_0x4f3d('0x1c')][_0x4f3d('0x28')](_0x4f3d('0x31')+_0x4ff67a));}[_0x4f3d('0x44')](){const _0xc904d9=this[_0x4f3d('0x56')];_0xc904d9[_0x4f3d('0x5')]['for'](_0x4f3d('0x4c'))[_0x4f3d('0x40')]({'model':_0x4f3d('0x4e'),'view':_0x548b27=>{const {id:_0x4213a2}=k(_0x548b27['markerName']),_0x288f3e=[_0x4f3d('0x39')];return this[_0x4f3d('0x14')]&&k(this[_0x4f3d('0x14')])['id']===_0x4213a2&&_0x288f3e[_0x4f3d('0x51')](_0x4f3d('0x3d')),{'classes':_0x288f3e,'attributes':{'data-comment':_0x4213a2}};}}),_0xc904d9[_0x4f3d('0x5')]['for'](_0x4f3d('0x35'))[_0x4f3d('0x50')]({'model':_0x4f3d('0x4e'),'view':_0x450b5f=>{const _0x41a882=_0xc904d9['model'][_0x4f3d('0x1c')][_0x4f3d('0x29')](_0x450b5f),{id:_0x1c3df5,part:_0x14c3d7}=k(_0x450b5f);return _0x41a882['affectsData']?{'group':_0x4f3d('0x4e'),'name':_0x14c3d7?_0x1c3df5+':'+_0x14c3d7:_0x1c3df5}:null;}}),_0xc904d9[_0x4f3d('0x5')][_0x4f3d('0x3f')](_0x4f3d('0x8'))[_0x4f3d('0x3e')]({'view':{'name':_0x4f3d('0x4e'),'attribute':{'id':/^\w/}},'model':(_0x4ec135,{writer:_0x5a1afb})=>_0x5a1afb[_0x4f3d('0x33')](_0x4f3d('0x41'),{'data-name':_0x4f3d('0x31')+_0x4ec135['getAttribute']('id')})}),_0xc904d9[_0x4f3d('0x5')][_0x4f3d('0x3f')](_0x4f3d('0x8'))[_0x4f3d('0x3c')]({'view':_0x4f3d('0x4e')});}['_handleMarkerAddAndRemove'](){const _0x282d09=this['editor'],_0xcddfd3=_0x282d09[_0x4f3d('0x46')][_0x4f3d('0x29')](_0x4f3d('0xf')),_0x4507ed=new Set();_0x282d09['model']['document'][_0x4f3d('0x58')](_0x384fe7=>{let _0x35e955=!0x1;for(const [_0x3b8d72,_0x2c8455]of _0x282d09['model'][_0x4f3d('0x15')][_0x4f3d('0x22')][_0x4f3d('0x23')]){const {group:_0x19d8b7,id:_0x2536fb}=k(_0x3b8d72);let _0x48a0a8=_0x2c8455[_0x4f3d('0x45')];if(_0x4f3d('0x4e')!==_0x19d8b7||!_0x48a0a8)continue;const _0x140e99=_0x4f3d('0xe')===_0x48a0a8['root'][_0x4f3d('0x2f')];_0x140e99||(_0x48a0a8=y(_0x48a0a8,_0x282d09['model']),!_0x48a0a8||_0x48a0a8[_0x4f3d('0x10')](_0x2c8455[_0x4f3d('0x45')]))?!_0x48a0a8||!_0x282d09[_0x4f3d('0xa')]['hasContent'](_0x48a0a8)||this[_0x4f3d('0x3')][_0x4f3d('0x55')](_0x2536fb)&&_0x140e99?(_0x384fe7[_0x4f3d('0x38')](_0x3b8d72),_0x35e955=!0x0):_0x140e99||(this[_0x4f3d('0x1b')]?_0x4507ed[_0x4f3d('0x2d')](_0x2536fb):this['_attachThreadToMarker'](_0x2536fb)):(_0x384fe7[_0x4f3d('0x21')](_0x3b8d72,{'range':_0x48a0a8}),_0x35e955=!0x0);}return _0x35e955;}),this['on'](_0x4f3d('0x52'),(_0x4f07d4,_0x470b39,_0xce4f71)=>{if(!_0xce4f71&&_0x4507ed['size'])for(const _0x4e0452 of _0x4507ed)this[_0x4f3d('0x30')](_0x4e0452),_0x4507ed[_0x4f3d('0x1')](_0x4e0452);}),this[_0x4f3d('0x11')](_0x282d09[_0x4f3d('0xa')][_0x4f3d('0x1c')],_0x4f3d('0x27'),(_0x19d102,_0x48cfbc,_0xe9388,_0x170b71)=>{if(_0x170b71)return;const {id:_0x210b2f}=k(_0x48cfbc[_0x4f3d('0x43')]),_0x35701c=_0x282d09[_0x4f3d('0x46')][_0x4f3d('0x29')]('CommentsRepository')['getCommentThread'](_0x210b2f);_0x4507ed[_0x4f3d('0x1')](_0x210b2f),_0x35701c&&!this[_0x4f3d('0x2b')](_0x210b2f)&&(this[_0x4f3d('0x3')]['delete'](_0x210b2f),_0xcddfd3[_0x4f3d('0x54')](_0x210b2f));});}['_attachThreadToMarker'](_0x5bdb5a){if(this[_0x4f3d('0x3')][_0x4f3d('0x55')](_0x5bdb5a))return;this[_0x4f3d('0x3')]['add'](_0x5bdb5a);const _0x5e9cde=this['editor'],_0x53f143=_0x5e9cde['plugins']['get'](_0x4f3d('0xf')),_0x5ef627=_0x5e9cde[_0x4f3d('0x12')][_0x4f3d('0x29')](_0x4f3d('0x4a')),_0x46a7b1=()=>{const _0x423f26=this[_0x4f3d('0x2a')](_0x5bdb5a);if(0x0==_0x423f26[_0x4f3d('0x57')])return null;const _0xe34dec=_0x423f26[_0x4f3d('0xc')](_0xafb9b5=>_0x41970a(_0x5e9cde['editing'],_0xafb9b5));return _0xe34dec['sort']((_0x400e0d,_0x15895f)=>{const _0x417427=new _0x19002f(_0x400e0d),_0x450055=new _0x19002f(_0x15895f),_0x4c3962=_0x417427['top']-_0x450055[_0x4f3d('0x3b')];return 0x0==_0x4c3962?_0x417427['left']-_0x450055['left']:_0x4c3962;}),_0xe34dec[0x0];};!this[_0x4f3d('0x2a')](_0x5bdb5a)[0x0][_0x4f3d('0x4d')]?_0x5e9cde[_0x4f3d('0x2')]['view'][_0x4f3d('0x48')]('render',()=>{_0x53f143[_0x4f3d('0x32')]({'channelId':_0x5ef627,'threadId':_0x5bdb5a,'target':_0x46a7b1});},{'priority':'low'}):_0x53f143['fetchCommentThread']({'channelId':_0x5ef627,'threadId':_0x5bdb5a})[_0x4f3d('0x6')](_0x34e5d5=>{if(_0x4f3d('0x1e')!==_0x5e9cde[_0x4f3d('0x47')]){if(_0x34e5d5)_0x34e5d5[_0x4f3d('0x42')](_0x46a7b1);else{const _0x7db5de=this[_0x4f3d('0x2a')](_0x5bdb5a);_0x5e9cde[_0x4f3d('0xa')][_0x4f3d('0x4')](_0xa5a97f=>{for(const _0x44a928 of _0x7db5de)_0xa5a97f[_0x4f3d('0x38')](_0x44a928);});}}});}}function g(_0x38eeba,_0x319d96){return _0x319d96?_0x38eeba+':'+_0x319d96:_0x38eeba;}function k(_0x30b579){const _0x4b3380=_0x30b579[_0x4f3d('0x2e')](':');return{'group':_0x4b3380[0x0],'id':_0x4b3380[0x1],'part':_0x4b3380[0x2]};}function y(_0x230008,_0x51dc5a){const _0x4f090f=_0x51dc5a[_0x4f3d('0x59')],_0x4212d3=_0x51dc5a[_0x4f3d('0x1d')](_0x230008[_0x4f3d('0x34')]);for(const _0x10f93e of _0x230008[_0x4f3d('0x18')]()){const {type:_0xf37409,item:_0xf53fbc,nextPosition:_0x1e1e4b}=_0x10f93e;if(_0x4f3d('0x16')===_0xf37409||_0x4f090f['isObject'](_0xf53fbc)){const _0x2f3f92=_0x51dc5a[_0x4f3d('0x17')](_0xf53fbc);_0x4212d3['isCollapsed']&&(_0x4212d3[_0x4f3d('0x34')]=_0x2f3f92),_0x4212d3[_0x4f3d('0xb')]=_0x1e1e4b;}}return _0x4212d3[_0x4f3d('0x13')]?null:_0x4212d3;}