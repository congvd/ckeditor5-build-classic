/*
 *             Copyright (c) 2016 - 2021, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
import{Plugin as _0x1cfd91}from'ckeditor5/src/core';import _0x1ebdf3 from'./commentsrepository';import _0x40f6aa from'./commentsediting';import _0x51f2be from'../annotations/editorannotations';import{ButtonView as _0x384aa3}from'ckeditor5/src/ui';import _0x1fc0ba from'../../theme/icons/add-comment.svg';import _0x44df56 from'../annotations/annotations';export default class n extends _0x1cfd91{static get['pluginName'](){return'CommentsUI';}static get['requires'](){return[_0x1ebdf3,_0x40f6aa,_0x51f2be,_0x44df56];}['init'](){const _0x4d4025=this['editor'],_0x561e72=_0x4d4025['plugins']['get'](_0x1ebdf3),_0x37a9f0=_0x4d4025['plugins']['get'](_0x40f6aa),_0x45c11a=_0x4d4025['plugins']['get'](_0x44df56),_0x472ea8=_0x4d4025['plugins']['get'](_0x51f2be);_0x4d4025['ui']['componentFactory']['add']('comment',()=>this['_createUIButton']()),_0x472ea8['addSourceCollector'](()=>{const _0x2bdf28=[];for(const [_0x52ff3d,_0x1ebd3e]of _0x561e72['_threadToController']){const _0x244892=_0x37a9f0['getAllMarkersForId'](_0x52ff3d['id']),_0xbed43c=_0x244892['map'](_0x2cdde5=>_0x2cdde5['getRange']());_0x244892['length']>0x0&&_0x2bdf28['push']([_0x1ebd3e['view'],_0xbed43c]);}return _0x2bdf28;}),this['listenTo'](_0x45c11a,'change:activeAnnotations',(_0x1aa112,_0x3b4448,_0x594263)=>{const _0x3b6594=Array['from'](_0x594263)['map'](_0x43717e=>_0x43717e['innerView'])['find'](_0x3a1846=>_0x561e72['_viewToController']['has'](_0x3a1846));if(!_0x3b6594)return void(_0x37a9f0['activeMarker']=null);const _0x1f8b5b=_0x561e72['_viewToController']['get'](_0x3b6594)['model']['id'],_0x247821='comment:'+_0x1f8b5b;_0x37a9f0['hasMarkerForId'](_0x1f8b5b)?_0x37a9f0['activeMarker']=_0x247821:_0x37a9f0['activeMarker']&&(_0x37a9f0['activeMarker']=null);}),this['listenTo'](_0x561e72,'removeCommentThread',(_0x2a7779,{threadId:_0x2e7b03,isFromAdapter:_0x21211d})=>{!_0x21211d&&_0x4d4025['ui']['focusTracker']['isFocused']&&_0x37a9f0['hasMarkerForId'](_0x2e7b03)&&_0x4d4025['editing']['view']['focus']();},{'priority':'highest'}),this['listenTo'](_0x561e72,'addComment',(_0x95f199,{threadId:_0x30b0dc,isFromAdapter:_0x50b2db})=>{if(_0x50b2db||!_0x37a9f0['hasMarkerForId'](_0x30b0dc)||!_0x561e72['hasCommentThread'](_0x30b0dc))return;0x1===_0x561e72['getCommentThread'](_0x30b0dc)['length']&&(_0x4d4025['editing']['view']['focus'](),_0x95f199['stop']());},{'priority':'low'});}['_createUIButton'](){const _0x275a1a=this['editor'],_0x17777a=new _0x384aa3(_0x275a1a['locale']),_0x7adc46=_0x275a1a['commands']['get']('addCommentThread'),{t:t}=this['editor']['locale'];return _0x17777a['label']=t('Comment'),_0x17777a['tooltip']=t('Comment'),_0x17777a['icon']=_0x1fc0ba,_0x17777a['bind']('isEnabled')['to'](_0x7adc46),this['listenTo'](_0x17777a,'execute',()=>_0x7adc46['execute']()),_0x17777a;}}