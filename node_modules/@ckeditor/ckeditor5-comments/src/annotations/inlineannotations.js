/*
 *             Copyright (c) 2016 - 2021, CKSource - Frederico Knabben. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5c9b=['_balloon','init','includes','_selectedAnnotations','updatePosition','listenTo','activeAnnotation','destroy','detach','editing','hasActive','pluginName','get','document','context','change:isFocused','inlineannotations-attach-already-attached','_removeAnnotationFromBalloon','Esc','targetRect','hasView','_addedAnnotations','set','selection','plugins','attach','setActiveAnnotation','stopListening','visibleView','inlineannotations-detach-not-attached','requires','view','_manuallyClosed','isActive','_annotations','change:height','focusTracker','editor','keystrokes','editableElement','has','getByView','inlineannotations-not-allowed-with-context','_setSelectedAnnotations','bind','EditorAnnotations','focus','delete','_addAnnotationToBalloon','isAttached','add','refresh','addObserver','remove','update'];(function(_0x1009cb,_0x5c9b36){const _0x23ab6d=function(_0x5f529f){while(--_0x5f529f){_0x1009cb['push'](_0x1009cb['shift']());}};_0x23ab6d(++_0x5c9b36);}(_0x5c9b,0xa7));const _0x23ab=function(_0x1009cb,_0x5c9b36){_0x1009cb=_0x1009cb-0x0;let _0x23ab6d=_0x5c9b[_0x1009cb];return _0x23ab6d;};import{Plugin as _0x147236}from'ckeditor5/src/core';import _0x56d8f4 from'./annotationsuis';import _0x2a6ae9 from'./editorannotations';import{ContextualBalloon as _0x560e5}from'ckeditor5/src/ui';import{MouseObserver as _0x2f0d8b}from'ckeditor5/src/engine';import{CKEditorError as _0x54b0fb}from'ckeditor5/src/utils';import'./../../theme/annotation-inline.css';export default class a extends _0x147236{static get[_0x23ab('0x1c')](){return[_0x2a6ae9,_0x560e5,_0x56d8f4];}static get[_0x23ab('0x9')](){return'InlineAnnotations';}constructor(_0x1a734f){super(_0x1a734f),_0x1a734f[_0x23ab('0x7')][_0x23ab('0x1d')][_0x23ab('0x32')](_0x2f0d8b),this[_0x23ab('0x2f')]=!0x1,this[_0x23ab('0x14')](_0x23ab('0x4'),null),this[_0x23ab('0x20')]=null,this[_0x23ab('0x1e')]=new Set(),this[_0x23ab('0x35')]=_0x1a734f['plugins'][_0x23ab('0xa')](_0x560e5),this['_addedAnnotations']=new Set(),this[_0x23ab('0x1')]=[];}[_0x23ab('0x36')](){const _0x55913e=this[_0x23ab('0x23')][_0x23ab('0x16')][_0x23ab('0xa')](_0x56d8f4);_0x55913e[_0x23ab('0xc')]===this[_0x23ab('0x23')]&&(_0x55913e['register']('inline',this),this[_0x23ab('0x23')][_0x23ab('0x24')][_0x23ab('0x14')]('Esc',(_0x368c05,_0x1ee157)=>{const _0x2b2b04=this[_0x23ab('0x35')];if(this[_0x23ab('0x2f')]&&_0x2b2b04[_0x23ab('0x1a')]){const _0x34ee20=this['_annotations'][_0x23ab('0x27')](_0x2b2b04[_0x23ab('0x1a')]);this['_manuallyClosed']['add'](_0x34ee20),this[_0x23ab('0xf')](_0x34ee20),_0x1ee157();}}));}['afterInit'](){const _0x424dfc=this[_0x23ab('0x23')]['plugins']['get'](_0x56d8f4);_0x424dfc[_0x23ab('0xc')]===this[_0x23ab('0x23')]&&(_0x424dfc[_0x23ab('0x8')]()||_0x424dfc['switchTo']('inline'));}[_0x23ab('0x18')](_0x3c9924){_0x3c9924!==this['activeAnnotation']&&(this[_0x23ab('0x4')]&&(this[_0x23ab('0x4')][_0x23ab('0x1f')]=!0x1),_0x3c9924&&this['editor']['ui'][_0x23ab('0x22')]['isFocused']&&(this[_0x23ab('0x2e')](_0x3c9924,!0x0),_0x3c9924[_0x23ab('0x1f')]=!0x0),_0x3c9924||this[_0x23ab('0x29')]([]),this[_0x23ab('0x4')]=_0x3c9924);}[_0x23ab('0x17')](_0x50a910){this[_0x23ab('0x20')]=_0x50a910;const _0x3e18f9=this[_0x23ab('0x23')][_0x23ab('0x16')][_0x23ab('0xa')](_0x56d8f4),_0xec263b=this[_0x23ab('0x35')];if(this['isAttached'])throw new _0x54b0fb(_0x23ab('0xe'),this);if(_0x3e18f9[_0x23ab('0xc')]!==this[_0x23ab('0x23')])throw new _0x54b0fb(_0x23ab('0x28'),this);const _0x2d153c=this[_0x23ab('0x23')][_0x23ab('0x16')][_0x23ab('0xa')](_0x23ab('0x2b'));this[_0x23ab('0x3')](_0x2d153c,_0x23ab('0x31'),function(){const _0x3a6124=_0x2d153c['getOrderedSelectedAnnotations']({'activeAnnotation':this[_0x23ab('0x4')],'annotations':this['_annotations']});this['_setSelectedAnnotations'](_0x3a6124),this[_0x23ab('0x18')](_0x3a6124[0x0]||null);}[_0x23ab('0x2a')](this)),this['listenTo'](_0x2d153c,'blur',(_0x5d5e88,{isAnnotationTracked:_0x475f2b})=>{this['activeAnnotation']&&_0x475f2b(this['activeAnnotation'])&&(this[_0x23ab('0x29')]([]),this['setActiveAnnotation'](null));}),this['listenTo'](this[_0x23ab('0x23')]['ui'][_0x23ab('0x22')],_0x23ab('0xd'),(_0x1915d7,_0x1629df,_0x52402c)=>{_0x52402c||this[_0x23ab('0x18')](null);}),this[_0x23ab('0x3')](_0x50a910,_0x23ab('0x33'),(_0x533f1b,_0x20fdda)=>{this[_0x23ab('0xf')](_0x20fdda),_0x20fdda===this[_0x23ab('0x4')]&&this[_0x23ab('0x18')](null);}),this[_0x23ab('0x3')](_0xec263b,'change:visibleView',(_0x11acd8,_0x16761a,_0x33ac6e,_0x4a4b80)=>{if(_0x4a4b80&&this[_0x23ab('0x19')](_0x4a4b80),!_0x33ac6e||!_0x50a910['getByView'](_0x33ac6e))return;const _0x50fb9e=_0x50a910[_0x23ab('0x27')](_0x33ac6e);this[_0x23ab('0x3')](_0x33ac6e,_0x23ab('0x21'),()=>{_0xec263b[_0x23ab('0x2')]();}),this[_0x23ab('0x3')](_0x33ac6e,_0x23ab('0x10'),()=>{this['_manuallyClosed'][_0x23ab('0x30')](_0x50fb9e),this[_0x23ab('0xf')](_0x50fb9e),this[_0x23ab('0x23')][_0x23ab('0x7')][_0x23ab('0x1d')]['focus']();}),this[_0x23ab('0x4')]!==_0x50fb9e&&this[_0x23ab('0x18')](_0x50fb9e);}),this['listenTo'](this[_0x23ab('0x23')]['ui'],_0x23ab('0x34'),()=>{_0xec263b[_0x23ab('0x1a')]&&(_0x50a910[_0x23ab('0x27')](_0xec263b[_0x23ab('0x1a')])&&_0xec263b[_0x23ab('0x2')]());}),this[_0x23ab('0x3')](this['editor'][_0x23ab('0x7')][_0x23ab('0x1d')]['document'],'mousedown',()=>{this['_manuallyClosed']['clear']();}),this[_0x23ab('0x23')][_0x23ab('0x7')][_0x23ab('0x1d')][_0x23ab('0xb')][_0x23ab('0x15')][_0x23ab('0x25')]&&this[_0x23ab('0x23')][_0x23ab('0x7')][_0x23ab('0x1d')][_0x23ab('0x2c')](),this[_0x23ab('0x2f')]=!0x0;}['detach'](){if(!this[_0x23ab('0x2f')])throw new _0x54b0fb(_0x23ab('0x1b'),this);this[_0x23ab('0x18')](null);for(const _0x5de987 of this['_addedAnnotations'])this[_0x23ab('0xf')](_0x5de987);this[_0x23ab('0x19')](),this['isAttached']=!0x1;}[_0x23ab('0x5')](){this[_0x23ab('0x2f')]&&this[_0x23ab('0x6')]();}['_setSelectedAnnotations'](_0x8b55c8){const _0x59d0e1=this['_selectedAnnotations'];for(const _0x4dc65a of _0x59d0e1)_0x8b55c8[_0x23ab('0x0')](_0x4dc65a)||this[_0x23ab('0x1e')][_0x23ab('0x2d')](_0x4dc65a);for(const _0x597e7e of this['_annotations'])_0x8b55c8[_0x23ab('0x0')](_0x597e7e)||this['_removeAnnotationFromBalloon'](_0x597e7e);if(this[_0x23ab('0x23')]['ui'][_0x23ab('0x22')]['isFocused'])for(const _0x22566e of _0x8b55c8)this[_0x23ab('0x2e')](_0x22566e);this[_0x23ab('0x1')]=_0x8b55c8;}[_0x23ab('0x2e')](_0x1fb732,_0x54c662){this[_0x23ab('0x1e')][_0x23ab('0x26')](_0x1fb732)||(this['_addedAnnotations'][_0x23ab('0x26')](_0x1fb732)||this[_0x23ab('0x35')][_0x23ab('0x12')](_0x1fb732[_0x23ab('0x1d')])||(this[_0x23ab('0x13')][_0x23ab('0x30')](_0x1fb732),this[_0x23ab('0x35')][_0x23ab('0x30')]({'stackId':_0x1fb732[_0x23ab('0x1d')]['id'],'view':_0x1fb732[_0x23ab('0x1d')],'position':{'target':()=>_0x1fb732['target']||_0x1fb732[_0x23ab('0x11')]||document['getSelection']()['getRangeAt'](0x0)}})),_0x54c662&&this[_0x23ab('0x35')]['showStack'](_0x1fb732['view']['id']));}[_0x23ab('0xf')](_0x3e9749){this[_0x23ab('0x13')][_0x23ab('0x26')](_0x3e9749)&&this[_0x23ab('0x35')][_0x23ab('0x12')](_0x3e9749[_0x23ab('0x1d')])&&(this[_0x23ab('0x13')][_0x23ab('0x2d')](_0x3e9749),this[_0x23ab('0x35')][_0x23ab('0x33')](_0x3e9749[_0x23ab('0x1d')]));}}